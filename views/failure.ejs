<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tradetips | paymentunsucessful</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="container-fluid">
            <img class="img-fluid" src="img/tradetiplogo.svg" alt="logo">
        </div>
    </header>
     <section class="paymentunsucssful-section bg-grey">
         <div class="container">
             <div class="unsucssful flex-row card card-padd shadow-sm rounded-card mb-3 mb-lg-4 d-flex align-items-center">
                <img src="img/unsucess.svg" alt="unsucess">
                <div class="unsucess-content">
                    <h2 class="form-heading">Payment unsuccessfull</h2>
                    <p class="m-0">There was a problem processing your credit card. For security reasons, we may need you to re-enter your 
                      card number 
                        details before trying again. If you still face this issue - please email us at <a href="mailto:contact@TradeTipsApp.com">contact@TradeTipsApp.com</a></p>
                </div>
             </div>
              <div class="card card-padd shadow-sm rounded-card mb-3 mb-lg-4">
                <div class="newsletter-content padd_x20">
                     <span class="newsletter" id="typeService"></span>
                     <h2 id="nameService"></h2>
                     <p id="shortDescriptionService"></p>
                    <span class="news-client" id="mentorNameService"></span>
                </div>
                <div class="subscription d-flex align-items-center">
                    <img src="img/dollar.svg" alt="dollar-icon">
                    <h3 class="sub-name" id="frequncyService"></h3>
                    <h3 class="sub-price" id="priceService"></h3>
                </div>
            </div>
            <div class="card card-padd shadow-sm rounded-card mb-3 mb-lg-4 position-relative">
              <div class="signup-thank mb-3 mb-lg-4">
                <h2 class="form-heading">Thank you for signing up for this service, <%= name %>!</h2>
                <p class="m-0">Remember your username <%= name %> and password.</p>
              </div>
              <div class="what-next">
                <h2 class="form-heading">What’s Next?</h2>
                <p class="m-0">Once you complete the payment below, look out for a Getting Started email from us at  <%= email %>
                  Use your username and password to log into the TradeTips app. Download it from your app store. </p>
              </div>
            </div>
            <div class="card card-padd shadow-sm rounded-card mb-3 mb-lg-4">
                <h2 class="form-heading mb-4">Order Summary</h2>
                <div class="order-summery">
                    <div class="order-content">
                      <div class="order-product d-flex justify-content-between align-items-center">
                        <div class="product-detail d-flex align-items-center">
                            <div class="product-img">
                                <img class="img-fluid w-100" src="img/product.png" alt="product">
                            </div>
                            <div>
                              <p class="product-text d-inline-block" id="nameServiceorder"></p>
                              <p class="product-mentor"><%= name %></p>
                            </div>
                        </div>
                        <h4 class="product-price"  id="priceServiceorder"></h4>
                    </div>
                    </div>
                   <h5 class="promo">Enter A Promo Code</h5>
                   <div class="row">
                    <div class="col-lg-7">
                    <form class="form-inline">
                      <input type="text" class="form-control apply-input mr-sm-2" name="text1" id="couponadd" placeholder=""
                      style="margin-right: 10px" />
                        <button class="btn btn-main btn-blue my-2 my-sm-0" type="button" id="stockadd"
                      onclick="validate(document.getElementsByName('text1')[0].value)">Apply</button>
                    </form>
                    <div class="successmsg3"></div>
                    </div>

                  <div class="col-lg-5" id="coupan-applyed" style="display:none">
                    <div class="subtotal d-flex align-items-end justify-content-end flex-column">
                        <div class="list-item">
                            <p>Subtotal</p>
                            <span id="priceServiceordertotal"></span>
                        </div>
                        <div class="list-item">
                            <p>Discount</p>
                            <span id="discountorderservice">$0</span>
                        </div>
                        <div class="list-item">
                            <p class="m-0"><b>Total</b></p>
                            <span><b id="priceServices"></b></span>
                        </div>  
                    </div>
                    </div>
                </div>
                </div>
                <h2 class="form-heading my-4 ">Enter Payment Information</h2>
                <div class="row">
                    <div class="col-lg-7">
                        <form action="payment" method="POST" onSubmit="handleFormSubmit(this); return false;">
                          <input type="text" name="userName" value="<%= name %>" style="display: none" />
                          <input type="text" name="userId" value="<%= id %>" style="display: none" />
                          <input type="text" name="emailData" value="<%= email %>" style="display: none" />
                          <input type="text" name="tokendata" value="<%= tokens %>" style="display: none" />
                          <input type="text" name="amount" id="prices" style="display: none" />
                          <input type="text" name="serviceIds" value="<%= service %>" style="display: none" />
                          <div class="form-group form-row align-items-center ml-0">
                            <label class="col-12" for="exampleInputEmail1">Enter Card Number</label>
                            <input type="text" class="form-control col-md-10 col-12" name="cardNumber" id="cardNumber" placeholder=""
                              onkeypress="return IsNumeric(event);" ondrop="return false;" onpaste="return false;"
                              required="required">
                              <div class="card-img col-2">
                                <img class="img-fluid" src="img/card.svg" alt="img">
                              </div>
                              <span id="error" style="color: Red; display: none">* Input digits (0 - 9)</span>
            
                          </div>
                          <div class="form-row align-items-center justify-content-between">
                            <div class="form-group col-md-5 col-6 form-row align-items-center ml-0">
                              <label for="">Exp. Date</label>
                              <input type="text" placeholder="MM/YY" class="form-control" onkeyup="formatString(event);"
                                name="monthYear" maxlength="5">
            
                            </div>
                            <div class="form-group col-md-6 col-6 form-row align-items-center ml-0">
                              <label class="col-12" for="inputZip">CVV</label>
                              <input type="text" class="form-control col-md-8 col-12" name="cvv" id="cvv" required="required"
                                maxlength="3" onkeypress="return IsNumerics(event);" ondrop="return false;">
                                <div class="card-img col-md-4 col-2">
                                  <img class="img-fluid" src="img/cvv.svg" alt="img">
                                </div>
                              <span id="errors" style="color: Red; display: none">* Input digits (0 - 9)</span>
                            </div>
                          </div>
                          <div class="form-group col-md-10 col-12 p-0">
                            <label for="exampleInputPassword1">Enter Cardholder’s Name</label>
                            <input type="text" class="form-control" placeholder="">
                          </div>
                          <div class="guranted d-flex align-items-center flex-row">
                            <img src="img/lock.svg" alt="lock">
                            <p class="mx-2">Guarenteed safe & secure checkout</p>
                            <img src="img/stript.svg" alt="stript">
                          </div>
                              <input type="submit" class="btn btn-main d-block w-100 btn-blue" value="Pay Securely">
                        </form>
                    </div>
                </div>
            </div>
         </div>
     </section>
</body>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script>
  function cc_format(value) {
    var v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, "");
    var matches = v.match(/\d{4,16}/g);
    var match = (matches && matches[0]) || "";
    var parts = [];
    for (i = 0, len = match.length; i < len; i += 4) {
      parts.push(match.substring(i, i + 4));
    }
    if (parts.length) {
      return parts.join(" ");
    } else {
      return value;
    }
  }

  onload = function () {
    document.getElementById("cardNumber").oninput = function () {
      this.value = cc_format(this.value);
    };
  };

  var specialKeys = new Array();
  specialKeys.push(8);
  function IsNumeric(e) {
    var keyCode = e.which ? e.which : e.keyCode;
    var ret =
      (keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1;
    document.getElementById("error").style.display = ret ? "none" : "inline";
    return ret;
  }
  function IsNumerics(e) {
    var keyCode = e.which ? e.which : e.keyCode;
    var ret =
      (keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1;
    document.getElementById("errors").style.display = ret ? "none" : "inline";
    return ret;
  }
  function IsNumericpincode(e) {
    var keyCode = e.which ? e.which : e.keyCode;
    var ret =
      (keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1;
    document.getElementById("errorpincode").style.display = ret
      ? "none"
      : "inline";
    return ret;
  }
</script>

<!-- ///////////////////////  For Month and year -->
<script>
  function formatString(e) {
    var inputChar = String.fromCharCode(event.keyCode);
    var code = event.keyCode;
    var allowedKeys = [8];
    if (allowedKeys.indexOf(code) !== -1) {
      return;
    }

    event.target.value = event.target.value
      .replace(
        /^([1-9]\/|[2-9])$/g,
        "0$1/" // 3 > 03/
      )
      .replace(
        /^(0[1-9]|1[0-2])$/g,
        "$1/" // 11 > 11/
      )
      .replace(
        /^([0-1])([3-9])$/g,
        "0$1/$2" // 13 > 01/3
      )
      .replace(
        /^(0?[1-9]|1[0-2])([0-9]{2})$/g,
        "$1/$2" // 141 > 01/41
      )
      .replace(
        /^([0]+)\/|[0]+$/g,
        "0" // 0/ > 0 and 00 > 0
      )
      .replace(
        /[^\d\/]|^[\/]*$/g,
        "" // To allow only digits and `/`
      )
      .replace(
        /\/\//g,
        "/" // Prevent entering more than 1 `/`
      );
  }
</script>
<input type="text" class="form-control" id="serviceIdDetaildata" value="<%= service %>" style="display: none;">

  <script type="text/javascript">  
  
  var subsids = "<%= service %>";
  // alert(subsids);

  var formdata = {serviceSubscriptionPlanId : subsids};
   $.ajax({
        type: 'POST',
        url: 'https://apistest.tradetipsapp.com/api/serviceMentorSubscriptionPlanWeb/getServiceSubscriptionPlanById',
        data: formdata,
        success: function(data) {
           var datak = JSON.stringify(data);
          // alert(datak);
          var dataResultp = JSON.parse(datak); 
          // alert(JSON.stringify(dataResultp));
          let str = dataResultp.stripeProductName;
          str = str.split("_")[0];
          document.getElementById("typeService").innerHTML = dataResultp.serviceTypeMaster.description;
          document.getElementById("nameService").innerHTML = dataResultp.title;
          document.getElementById("nameServiceorder").innerHTML = dataResultp.title;
          document.getElementById("shortDescriptionService").innerHTML = dataResultp.descriptionOne;
          // document.getElementById("longDescriptionService").innerHTML = dataResultp.descriptionTwo;
          document.getElementById("mentorNameService").innerHTML = "By " + str;
          if(dataResultp.frequency == "0"){
               document.getElementById("frequncyService").innerHTML = "One Time Subscription : " ;
          }else if(dataResultp.frequency == "1"){ 
                document.getElementById("frequncyService").innerHTML = "Daily Subscription : ";
          }else if(dataResultp.frequency == "7"){
              document.getElementById("frequncyService").innerHTML = "Weekly Subscription : ";
          }else if(dataResultp.frequency == "15"){
              document.getElementById("frequncyService").innerHTML = "Bi-weekly Subscription : ";
          }else if(dataResultp.frequency == "30"){
              document.getElementById("frequncyService").innerHTML = "Monthly Subscription : ";
          }else {
              document.getElementById("frequncyService").innerHTML = "Yearly Subscription : ";
          }
          document.getElementById("priceService").innerHTML = "$" + parseFloat(dataResultp.price).toFixed(2);
          document.getElementById("priceServiceorder").innerHTML = "$" + parseFloat(dataResultp.price).toFixed(2);
          document.getElementById("priceServiceordertotal").innerHTML = "$" + parseFloat(dataResultp.price).toFixed(2);
          document.getElementById("prices").value = dataResultp.price * 100;
          document.getElementById("priceServices").innerHTML = "$" + parseFloat(dataResultp.price).toFixed(2);


          // document.getElementById("priceServicess").innerHTML ="$" + parseFloat(dataResultp.price).toFixed(2);
         
        




}
});

   //////////////////////////coupon code validation /////////////////////////////////////////////

    var count = 0;

  function validate(coupon) {
    
    var formdata = { couponId: coupon };

    $.ajax({
      type: "POST",
      url: "https://apistest.tradetipsapp.com/api/stripePayment/validateCoupon",
      data: formdata,
      success: function (data, textStatus, jqXHR) {
        var finalpvals = data.percent_off;
        var pricess = $("#prices").val();
        var fdiscount = (pricess * finalpvals) / 100;
        if (data.valid == true) {
          count++;
          if (count == 1) {
            document.getElementById('coupan-applyed').style.display = 'block';
            document.getElementById('stockadd').style.backgroundColor = '#828282';
            document.getElementById('stockadd').innerHTML = 'Applied';

            
            var Damount = pricess - fdiscount;
            document.getElementById("prices").value = fdiscount;

            $(".successmsg3").html(" Discount applied. Please continue your purchase.");

            setTimeout(function () {
              $(".successmsg3").empty();
            }, 1200000);

            document.getElementById("discountorderservice").innerHTML = `<span>- </span><span>${"$" + (fdiscount / 100).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]} </span>`;

            document.getElementById("priceServices").innerHTML = "$" + parseFloat(
              Damount / 100
            ).toFixed(2);
          } else {
            $(".successmsg3").html(
              "Sorry, You can apply coupan code only once"
            );
            setTimeout(function () {
              $(".successmsg3").empty();
            }, 3000);
          }
        }
      },
      error: function (errMsg) {
        $(".successmsg3").html(
          "Sorry, The Coupon Code you entered is invalid. Please check and try again!"
        );
        setTimeout(function () {
          $(".successmsg3").empty();
        }, 3000);
      },
    });
  }

  
  </script>
</html>